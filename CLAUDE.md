# CLAUDE.md — Development Guide for ZION

## Supreme Law
The CONSTITUTION.md is the supreme law. If code and constitution disagree, the code is wrong.

## Project Structure
- `src/js/` — JavaScript modules (UMD pattern for browser + Node.js)
- `src/css/` — CSS files with design tokens
- `src/html/` — HTML template
- `scripts/` — Python scripts (stdlib only) and shell scripts
- `tests/` — JS tests (vanilla, zero-dep) and Python tests (unittest)
- `state/` — Canonical JSON state files
- `docs/index.html` — Bundled single-file client (generated by scripts/bundle.sh)

## Key Principles
1. **Single file client** — docs/index.html is the only file users need
2. **Protocol is the only interface** — no admin panels, no backdoors
3. **Zero npm** — vanilla JS only, Three.js and PeerJS from CDN
4. **Python stdlib only** — no pip dependencies
5. **JSON state** — all world state is readable, auditable JSON

## Build
```bash
./scripts/bundle.sh  # produces docs/index.html
```

## Test
```bash
./tests/run_all.sh   # runs JS + Python tests
```

## Module Dependency Order
protocol.js → zones.js → economy.js → state.js → intentions.js → social.js → creation.js → competition.js → exploration.js → physical.js → auth.js → network.js → world.js → input.js → hud.js → xr.js → audio.js → main.js

## Protocol Message Shape
Every action is a message: {v, id, ts, seq, from, type, platform, position, geo, payload}

## Adding Features
1. Define the message type in protocol.js
2. Add handling in state.js applyMessage
3. Add zone rule checks in zones.js if needed
4. Write tests first
5. Run tests until green
6. Bundle and verify
